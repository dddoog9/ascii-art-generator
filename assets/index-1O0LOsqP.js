var S=Object.defineProperty;var x=(a,r,e)=>r in a?S(a,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[r]=e;var c=(a,r,e)=>(x(a,typeof r!="symbol"?r+"":r,e),e);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&t(u)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();class b extends EventTarget{constructor(e){super();c(this,"_img");c(this,"_width",0);c(this,"_height",0);c(this,"_imgBuffer",null);c(this,"_canvasElem");c(this,"_canvasCx");this._img=new Image,this._img.crossOrigin="anonymous",e!==void 0&&(this._img.src=e);let t=document.createElement("canvas"),i=t.getContext("2d",{willReadFrequently:!0});if(i===null)throw new Error("canvas cx is null");this._canvasElem=t,this._canvasCx=i,this._img.addEventListener("load",()=>{this._width=this._img.width,this._height=this._img.height,this._makeImgBuffer(),this.dispatchEvent(new Event("load"))}),this._img.addEventListener("error",()=>{let s=new ErrorEvent("error");this.dispatchEvent(s)})}_makeImgBuffer(){let e=this._width,t=this._height;this._canvasElem.width=e,this._canvasElem.height=t,e!==0&&t!==0?(this._canvasCx.drawImage(this._img,0,0,e,t),this._imgBuffer=this._canvasCx.getImageData(0,0,e,t).data):this._imgBuffer=null}redraw(){return this._makeImgBuffer(),this}grayscale(){let e=this._imgBuffer;if(e!==null)for(let t=0;t<e.length;t+=4){let i=(e[t]+e[t+1]+e[t+2])/3;e[t]=i,e[t+1]=i,e[t+2]=i}return this}updateCanvasSurf(){let e=this._imgBuffer;if(e!==null){let t=new ImageData(e,this._width,this._height);this._canvasCx.putImageData(t,0,0)}return this}get img(){return this._img}get src(){return this._img.src}get buffer(){return this._imgBuffer}get canvas(){return this._canvasElem}get canvasCx(){return this._canvasCx}get width(){return this._width}get height(){return this._height}set src(e){this._img.src=e}set width(e){this._width=e,this._makeImgBuffer(),this.dispatchEvent(new Event("resize"))}set height(e){this._height=e,this._makeImgBuffer(),this.dispatchEvent(new Event("resize"))}}class N extends b{constructor(e=""){super(e);c(this,"_asciiStr","");c(this,"_asciiChars","@QB#NgWM8RDHdOKq9$6khEPXwmeZaoS2yjufF]}{tx1zv7lciL/\\|?*>r^;:_\"~,'.-`")}_pixelsToAscii(){let e=this.buffer;if(this._asciiStr="",e===null)return;let t=this._asciiChars;for(let i=0;i<e.length;i+=4){let s=Math.round(t.length/255*e[i]);s=Math.max(s,0),s=Math.min(s,t.length-1),this._asciiStr+=t.charAt(s)}}_insertNewlineChars(){if(this.buffer===null)return;let e=[],t=this._asciiStr,i=this.width,s=t.length;for(let u=0;u<s;u+=i)e.push(t.slice(u,u+i));this._asciiStr=e.join(`
`)}generate(e=!0){return e&&this.redraw(),this.grayscale(),this._pixelsToAscii(),this._insertNewlineChars(),this}get asciiStr(){return this._asciiStr}get asciiChars(){return this._asciiChars}set asciiChars(e){this._asciiChars=e}}let n=0,l=0,w=1,y=1,h=new N,I=!1,f=.5,p=!1,$=document.getElementById("preview"),d=document.getElementById("img-width"),g=document.getElementById("img-height"),m=document.getElementById("img-aspect"),L=document.getElementById("img-grayscale"),C=document.getElementById("img-upload"),v=document.getElementById("ascii-surf"),o=document.getElementById("ascii-scale"),E=document.getElementById("ascii-chars"),A=document.getElementById("notifi"),M=["error"];$.appendChild(h.canvas);o.value=String(f*100);v.style.transform="scale("+f+")";E.value=h.asciiChars;function O(a,r,e){let t=document.createElement("div");t.classList.add(M[r]),t.innerHTML=a,A.appendChild(t),e!==void 0&&setTimeout(()=>{t.remove()},e)}function B(){h.generate(!1),I&&h.updateCanvasSurf()}function _(){h.width=n,h.height=l,B(),v.innerHTML=h.asciiStr}h.addEventListener("load",()=>{n=h.width,l=h.height,m.checked&&n!==0&&l!==0&&(w=n/l,y=l/n),d.value=String(n),g.value=String(l),B(),v.innerHTML=h.asciiStr});h.addEventListener("error",()=>{p&&O("Unknown error",0,3500)});d.addEventListener("input",()=>{m.checked?(n=Number(d.value),l=Math.round(y*n),g.value=String(l)):n=Number(d.value),_()});d.addEventListener("change",()=>{d.value===""&&(d.value="0")});g.addEventListener("input",()=>{m.checked?(l=Number(g.value),n=Math.round(w*l),d.value=String(n)):l=Number(g.value),_()});g.addEventListener("change",()=>{g.value===""&&(g.value="0")});m.addEventListener("change",()=>{n!==0&&l!==0&&(w=n/l,y=l/n)});L.addEventListener("change",()=>{I=L.checked,_()});C.addEventListener("change",()=>{let a=C.files;a&&a[0]?(h.src=URL.createObjectURL(a[0]),p=!0):p=!1});o.addEventListener("input",()=>{f=Number(o.value)/100,v.style.transform="scale("+f+")"});o.addEventListener("change",()=>{o.value===""&&(o.value="0")});E.addEventListener("input",()=>{h.asciiChars=E.value,_()});
